(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/setemail/setemail"],{"05b9":function(e,i,t){},"18bb":function(e,i,t){"use strict";t.d(i,"b",(function(){return s})),t.d(i,"c",(function(){return a})),t.d(i,"a",(function(){return n}));var n={myEmail:function(){return t.e("components/my-email/my-email").then(t.bind(null,"8c84"))},uniCalendar:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uni-calendar/components/uni-calendar/uni-calendar")]).then(t.bind(null,"dee6"))}},s=function(){var e=this,i=e.$createElement;e._self._c},a=[]},5445:function(e,i,t){"use strict";(function(e){t("02d9");n(t("66fd"));var i=n(t("61b6"));function n(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=t,e(i.default)}).call(this,t("543d")["createPage"])},"56c7":function(e,i,t){"use strict";(function(e){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var t={data:function(){return{haveSave:!1,session:"",letterid:"",nowType:0,openziti:"开始写信",biaoti:"信封编辑",shoujianren:"",jijianren:"",startTime:{year:"",month:"",day:""},endTime:{year:"",month:"",day:""},beizhuAll:" ",beizhu:{ziti1:"",ziti2:"",ziti3:""},beizhuwenziFlag:!0,shoujianren_last:"",jijianren_last:"",startTime_last:{},endTime_last:{},beizhu_last:{},indexpic_last:0,shoujianMessageShow:!1,bottomDiv:0,endTimeShow:!1,endDateStr:"",youpiaoShow:!1,fuckwidth:"700rpx",youpiaoList:[{label:"000",free:!0,url:"https://afflatus.xyz/image/youpiao_none.png",ad:""},{label:"001",free:!0,url:"https://afflatus.xyz/image/youpiao1.jpg",ad:""},{label:"002",free:!0,url:"https://afflatus.xyz/image/youpiao2.jpg",ad:""},{label:"003",free:!0,url:"https://afflatus.xyz/image/youpiao3.jpg",ad:""}],indexpic:0,picnum:0,startData:{clientX:0,clientY:0}}},onLoad:function(i){var t=this;if(this.session=i.session,this.haveSave="true"==i.haveSave,2==i.nowType&&(this.nowType=i.nowType,this.openziti="打开信封",this.biaoti="信封",this.haveSave=!0,this.beizhuwenziFlag=!1),this.haveSave)this.letterid=i.letterid,e.request({url:"https://afflatus.xyz/loadLetterHead",method:"POST",data:{session:t.session,letterid:t.letterid},success:function(i){if(200==i.data.status){for(var n in t.shoujianren=i.data.data.receiveUsername,t.jijianren=i.data.data.sentUsername,t.startTime=JSON.parse(i.data.data.startTime),t.endTime=JSON.parse(i.data.data.endTime),t.beizhu=JSON.parse(i.data.data.remarks),t.youpiaoList)if(t.youpiaoList[n].url==i.data.data.stampFile){t.indexpic=n;break}t.shoujianren_last=JSON.parse(JSON.stringify(t.shoujianren)),t.jijianren_last=JSON.parse(JSON.stringify(t.jijianren)),t.startTime_last=JSON.parse(JSON.stringify(t.startTime)),t.endTime_last=JSON.parse(JSON.stringify(t.endTime)),t.beizhu_last=JSON.parse(JSON.stringify(t.beizhu)),t.indexpic_last=JSON.parse(JSON.stringify(t.indexpic)),""!=t.beizhu.ziti1&&(t.beizhuwenziFlag=!1)}else e.redirectTo({url:"../index/index"})}});else{var n=t.dateTimeStr();t.startTime.year=String(n.year),t.startTime.month=String(n.month),t.startTime.day=String(n.day),e.getStorage({key:"userInfo",success:function(e){t.jijianren=e.data.nickName},fail:function(){e.redirectTo({url:"../login/login"})}})}t.picnum=t.youpiaoList.length-1},onShow:function(){},methods:{bgclick:function(){this.shoujianMessageShow=!1,this.endTimeShow=!1,this.youpiaoShow=!1},start:function(e){this.startData.clientX=e.changedTouches[0].clientX,this.startData.clientY=e.changedTouches[0].clientY},move:function(i){var t=this,n=e.createSelectorQuery().select(".youpiaoMessage");i.changedTouches[0].clientX,this.startData.clientX,i.changedTouches[0].clientY,this.startData.clientY;n.fields({size:!0},(function(e){console.log(e.height),t.fuckwidth=e.height+"rpx"}))},end:function(e){var i=e.changedTouches[0].clientX-this.startData.clientX,t=e.changedTouches[0].clientY-this.startData.clientY;t>50||t<-50||(i>50?this.zuof():i<-50&&this.youf())},deleteLetter:function(){var i=this;e.showModal({title:"删除邮件",content:"删除后将无法撤回",success:function(t){t.confirm&&e.request({url:"https://afflatus.xyz/deleteLetter",method:"POST",data:{session:i.session,letterid:i.letterid},success:function(i){200==i.data.status?(console.log("删除成功"),e.redirectTo({url:"../index/index"})):console.log("删除失败")},fail:function(){console.log("删除失败")}})}})},returnIndex:function(){var i=this;if(0==i.haveSave){var t=i.dateTimeStr();i.letterid=t.year+t.month+t.day+t.hour+t.minute+t.second,e.showModal({title:"返回主页",content:"是否保存至草稿箱",success:function(t){t.confirm?e.request({url:"https://afflatus.xyz/updateLetterHead",method:"POST",data:{session:i.session,letterid:i.letterid,shoujianren:i.shoujianren,jijianren:i.jijianren,startTime:i.startTime,endTime:i.endTime,beizhu:i.beizhu,youpiao:i.youpiaoList[i.indexpic].url,haveSave:i.haveSave},success:function(i){e.redirectTo({url:"../index/index"})}}):t.cancel&&e.redirectTo({url:"../index/index"})}})}else i.shoujianren_last==i.shoujianren&&i.jijianren_last==i.jijianren&&JSON.stringify(i.startTime_last)==JSON.stringify(i.startTime)&&JSON.stringify(i.endTime_last)==JSON.stringify(i.endTime)&&JSON.stringify(i.beizhu_last)==JSON.stringify(i.beizhu)&&i.indexpic_last==i.indexpic?e.redirectTo({url:"../index/index"}):(console.log("有东西改变了"),e.showModal({title:"发现更新",content:"是否保存更新",success:function(t){t.confirm?e.request({url:"https://afflatus.xyz/updateLetterHead",method:"POST",data:{session:i.session,letterid:i.letterid,shoujianren:i.shoujianren,jijianren:i.jijianren,startTime:i.startTime,endTime:i.endTime,beizhu:i.beizhu,youpiao:i.youpiaoList[i.indexpic].url,haveSave:i.haveSave},success:function(i){200==i.data.status&&e.redirectTo({url:"../index/index"})}}):e.redirectTo({url:"../index/index"})}}))},beizhuGet:function(e){if(2==this.nowType)return 0;this.beizhuwenziFlag=!1,this.beizhuAll=this.beizhu.ziti1+this.beizhu.ziti2+this.beizhu.ziti3,this.beizhu.ziti1=this.beizhuAll,this.beizhu.ziti2="",this.beizhu.ziti3="",this.shoujianMessageShow=!1,this.endTimeShow=!1,this.youpiaoShow=!1},beizhuFinish:function(e){if(2==this.nowType)return 0;""==this.beizhu.ziti1&&(this.beizhuwenziFlag=!0);var i=this.beizhu.ziti1;this.beizhuAll=this.beizhu.ziti1,i<=17?this.beizhu.ziti1=this.beizhuAll.substring(0,17):i<=34?(this.beizhu.ziti1=this.beizhuAll.substring(0,17),this.beizhu.ziti2=this.beizhuAll.substring(17,34)):(this.beizhu.ziti1=this.beizhuAll.substring(0,17),this.beizhu.ziti2=this.beizhuAll.substring(17,34),this.beizhu.ziti3=this.beizhuAll.substring(34,51))},shoujianClick:function(){if(2==this.nowType)return 0;this.endTimeShow=!1,this.youpiaoShow=!1,this.shoujianMessageShow=!0},chooseWho:function(e){if(2==this.nowType)return 0;this.bottomDiv=e.detail.value,1==this.bottomDiv?this.shoujianren=this.jijianren:this.shoujianren=""},endTimeClick:function(){if(2==this.nowType)return 0;this.shoujianMessageShow=!1,this.youpiaoShow=!1,this.endTimeShow=!0;var e=new Date;e.setTime(e.getTime()+864e5);var i=e.getDate();i>=0&&i<=9&&(i="0"+i),this.endDateStr=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+i,this.endTime.day=String(i),this.endTime.year=String(e.getFullYear());var t=e.getMonth()+1;t>=1&&t<=9&&(t="0"+t),this.endTime.month=String(t),console.log(this.endTime)},endTimechange:function(e){if(2==this.nowType)return 0;this.endTimeShow=!1;var i=e.date;i>=0&&i<=9&&(i="0"+i),this.endTime.day=String(i),this.endTime.year=String(e.year),this.endTime.month=String(e.month)},dateTimeStr:function(){var e=new Date,i=e.getFullYear(),t=e.getMonth()+1,n=e.getDate(),s=e.getHours()<10?"0"+e.getHours():e.getHours(),a=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),o=e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds();return t>=1&&t<=9&&(t="0"+t),n>=0&&n<=9&&(n="0"+n),s>=0&&s<=9&&(s="0"+s),a>=0&&a<=9&&(a="0"+a),o>=0&&o<=9&&(o="0"+o),{year:i,month:t,day:n,hour:s,minute:a,second:o}},youpiaoClick:function(){if(2==this.nowType)return 0;this.shoujianMessageShow=!1,this.endTimeShow=!1,this.youpiaoShow=!0},zuof:function(){0!=this.indexpic&&(this.indexpic=Number(this.indexpic)-1)},youf:function(){this.indexpic!=this.picnum&&(this.indexpic=Number(this.indexpic)+1)},startWrite:function(){var i=this;if(2==this.nowType)e.requestSubscribeMessage({tmplIds:["Ue2gQHM_jKb-Z6iPwGAf69NkkURm-IqmjadGqrLgtOk"],success:function(t){console.log(t),-1!=JSON.stringify(t).indexOf("accept")?e.redirectTo({url:"../writeemail/writeemail?session="+i.session+"&letterid="+i.letterid+"&nowType="+i.nowType}):e.showToast({title:"请允许邮件提醒",mask:!0,icon:"none",duration:2e3})}});else if(""==this.shoujianren)e.showToast({title:"收件人不完整",icon:"none",mask:!0});else if(""==this.jijianren)e.showToast({title:"寄件人不完整",icon:"none",mask:!0});else if(""==this.endTime.year)e.showToast({title:"寄送时间缺失",icon:"none",mask:!0});else{if(console.log(this.startTime),console.log(this.endTime),this.shoujianMessageShow=!1,this.endTimeShow=!1,this.youpiaoShow=!1,e.showLoading({title:"新建信封中",mask:!0}),0==this.haveSave&&2!=this.nowType){var t=i.dateTimeStr();i.letterid=t.year+t.month+t.day+t.hour+t.minute+t.second,e.request({url:"https://afflatus.xyz/updateLetterHead",method:"POST",data:{session:i.session,letterid:i.letterid,shoujianren:i.shoujianren,jijianren:i.jijianren,startTime:i.startTime,endTime:i.endTime,beizhu:i.beizhu,youpiao:i.youpiaoList[i.indexpic].url,haveSave:i.haveSave},success:function(t){200==t.data.status&&e.redirectTo({url:"../writeemail/writeemail?session="+i.session+"&letterid="+i.letterid})}})}else 1==this.haveSave&&2!=this.nowType?i.shoujianren_last==i.shoujianren&&i.jijianren_last==i.jijianren&&JSON.stringify(i.startTime_last)==JSON.stringify(i.startTime)&&JSON.stringify(i.endTime_last)==JSON.stringify(i.endTime)&&JSON.stringify(i.beizhu_last)==JSON.stringify(i.beizhu)&&i.indexpic_last==i.indexpic?e.redirectTo({url:"../writeemail/writeemail?session="+i.session+"&letterid="+i.letterid}):e.request({url:"https://afflatus.xyz/updateLetterHead",method:"POST",data:{session:i.session,letterid:i.letterid,shoujianren:i.shoujianren,jijianren:i.jijianren,startTime:i.startTime,endTime:i.endTime,beizhu:i.beizhu,youpiao:i.youpiaoList[i.indexpic].url,haveSave:i.haveSave},success:function(t){console.log("fuck"),200==t.data.status&&e.redirectTo({url:"../writeemail/writeemail?session="+i.session+"&letterid="+i.letterid})}}):1==this.haveSave&&this.nowType;e.hideLoading()}}}};i.default=t}).call(this,t("543d")["default"])},"61b6":function(e,i,t){"use strict";t.r(i);var n=t("18bb"),s=t("c008");for(var a in s)"default"!==a&&function(e){t.d(i,e,(function(){return s[e]}))}(a);t("d850");var o,r=t("f0c5"),u=Object(r["a"])(s["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],o);i["default"]=u.exports},c008:function(e,i,t){"use strict";t.r(i);var n=t("56c7"),s=t.n(n);for(var a in n)"default"!==a&&function(e){t.d(i,e,(function(){return n[e]}))}(a);i["default"]=s.a},d850:function(e,i,t){"use strict";var n=t("05b9"),s=t.n(n);s.a}},[["5445","common/runtime","common/vendor"]]]);